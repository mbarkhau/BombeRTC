!function(n,e){"use strict";function r(n,e){return function(n,r){return null==n?n:"bool"==e?r?n&&1||0:n&&!0||!1:"int36"==e?r?n.toString(36):parseInt(n,36):"date"==e?r?Math.round(n/1e3):new Date(1e3*n):"isodate"==e?r?n.toISOString():new Date(Date.parse(n)):n}}function t(n){return function(e,r){for(var t=n.length,i=r>0?0:t-1,f=r>0?t:-1;i!=f;i+=r)e=n[i](e,1!=r);return e}}function i(n){if(n&&!l[n]){for(var e,i,f,u=n.match(/(\\.|[^\|])+/g),o=[],a=u.length-1;a>=0;a--){if(e=u[a],i=e.match(/(\\.|[^:])+/g),e=i[0],!e||l[e])return;for(i=i.slice(1),f=i.length-1;f>=0;f--)i[f]=i[f].replace("\\","");o.push((s[e]||r)(i,e))}s[n]=t(o)}}function f(n){for(var e=n.meta=n.meta||[],r=n.fields.length-1;r>=0;r--)e[r]=e[r]||0,i(h(e[r]))}function u(n,e,r,t){var i,f=h(e),u=s[f];if(u&&f!=e){for(n=n.slice(0),i=n.length-1;i>=0;i--)n[i]=u(n[i],t);return n}return null==n?n:l[f]?r(n,e,1):u?u(n,t):n}function o(n,e,r){var t,i,f=h(e),a=l[f],c=a.fields,s=0,g=[];n instanceof Array&&"["!=e[0]&&(e="[]"+e),r||(g[0]=e),f==e&&(n=[n]);for(var d=n.length,p=c.length;d>s;s++)for(i=n[s],t=0;p>t;t++)g.push(u(i[c[t]],a.meta[t],o,-1));return r?g:JSON.stringify(g)}function a(n,e,r){var t,i,f="string"==typeof n?JSON.parse(n):n,o=f.length,c=[],s=r?0:1;e||(e=f[0]);for(var g=h(e),d=l[g],p=d.fields,m=p.length;o>s;s+=m){for(t={},i=0;m>i;i++)t[p[i]]=u(f[s+i],d.meta[i],a,1);if(e==g)return t;c.push(t)}return c}function c(n){if("string"==typeof n&&(n=a(n)),n instanceof Array)for(var e=0;e<n.length;e++)c(n[e]);else l[n.id]=n,f(n)}var s={"enum":function(n){for(var e=n.unshift(0),r={};e--;)r[n[e]]=e;return function(e,t){return t?r[e]||e:n[e]||e}},prefix:function(n){var e=new RegExp("^"+n[0]);return function(r,t){return t?r.replace(e,""):n[0]+r}},suffix:function(n){var e=new RegExp(n[0]+"$");return function(r,t){return t?r.replace(e,""):r+n[0]}}},l={schema:{id:"schema",fields:["id","fields","meta"],meta:[0,"[]","[]"]}},h=function(n){return"["==n[0]?n.slice(2):n};n.KSON=e.exports={coders:s,addSchema:c,parse:a,stringify:o}}(this,"undefined"==typeof module?{}:module);